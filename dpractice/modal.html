<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Modal Verbs Worksheet</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: Arial, sans-serif; background: #f9f9ff; margin: 0; }
        .container { max-width: 540px; margin: 12px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #ccc; padding: 16px; }
        .info-box input, .info-box select { width: 98%; padding: 6px; margin-bottom: 8px; border-radius: 3px; border: 1px solid #aaa;}
        .questions, .rewrite { margin: 16px 0; }
        .question, .rewrite-q { margin-bottom: 13px;}
        .question span, .rewrite-q span { min-width: 19px; display: inline-block;}
        .export-box { margin: 21px 0 8px 0; display: grid; gap: 8px; grid-template-columns: repeat(2, 1fr);}
        .grade-box { margin-bottom: 8px; background: #e8eafb; padding: 6px 16px; border-radius: 4px; display: inline-block; cursor: pointer; font-weight: bold; }
        .answers { display: none; margin-top: 14px; background: #fffbdb; padding: 10px; border-radius: 6px;}
        h2, h3 { margin-bottom: 7px; }
        .subtitle {color: #1115bb;}
        #scoreResult { margin-bottom: 10px; font-size: 1.1em; color: #0944ab; }
        @media (max-width: 600px) {
            .container { padding: 4px; }
        }
        .check-grade { margin: 8px 0; padding: 8px 20px; background: #48a34e; color: #fff; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
    </style>
    <!-- External scripts for export functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
</head>
<body>
<div class="container">
    <h2>Modal Verbs Worksheet</h2>
    <div class="subtitle info-box">
        Student: <input type="text" placeholder="Name" id="studentName">
        ID: <input type="text" placeholder="ID/Roll No." id="studentID">
        Grade: 
        <select id="gradeSelect">
            <option value="">Select</option><option>7</option><option>8</option>
            <option>9</option><option>10</option><option>11</option><option>12</option>
        </select>
        <div class="grade-box" id="gradeBox">Grade: <span id="gradeValue"> - </span></div>
    </div>
    <div id="scoreResult"></div>
    <form id="modalForm">
        <h3>Part 1: Fill in the Blanks</h3>
        <div class="questions">
            <div class="question">1. <span>______</span> I borrow your ruler, please? <input name="q1"></div>
            <div class="question">2. My father <span>______</span> speak four languages fluently. He can also write in two more languages. <input name="q2"></div>
            <div class="question">3. If you want to pass your exams, you <span>______</span> work very hard. <input name="q3"></div>
            <div class="question">4. You <span>______</span> get wet because it’s raining outside! <input name="q4"></div>
            <div class="question">5. <span>______</span> you lend me your pen for a moment? <input name="q5"></div>
            <div class="question">6. Do you think you <span>______</span> help me with my homework tonight? <input name="q6"></div>
            <div class="question">7. He <span>______</span> go home early yesterday, because he felt ill. <input name="q7"></div>
            <div class="question">8. You <span>______</span> smoke because it’s bad for your health. <input name="q8"></div>
            <div class="question">9. <span>______</span> I go home now because I am tired? <input name="q9"></div>
            <div class="question">10. That student <span>______</span> not coming tomorrow. He is sick. <input name="q10"></div>
            <div class="question">11. You <span>______</span> not enter the library with food or drink. <input name="q11"></div>
            <div class="question">12. She <span>______</span> sing when she was four. <input name="q12"></div>
            <div class="question">13. <span>______</span> I take my bag with me? <input name="q13"></div>
            <div class="question">14. I am not sure, but he <span>______</span> come to my party. <input name="q14"></div>
            <div class="question">15. We <span>______</span> not go on holiday because we didn’t have enough money. <input name="q15"></div>
            <div class="question">16. You <span>______</span> not park here, it’s forbidden. <input name="q16"></div>
            <div class="question">17. He <span>______</span> understand English, but he <span>______</span> not speak it very well. <input name="q17a"> <input name="q17b"></div>
            <div class="question">18. You <span>______</span> not drive so fast, it’s not safe. <input name="q18"></div>
            <div class="question">19. My brother <span>______</span> not swim, but he <span>______</span> play basketball. <input name="q19a"> <input name="q19b"></div>
            <div class="question">20. Children under twelve <span>______</span> not come into the museum without an adult. <input name="q20"></div>
            <div class="question">21. <span>______</span> you open the window, please? It’s so hot. <input name="q21"></div>
            <div class="question">22. <span>______</span> I go out tonight with my friends? <input name="q22"></div>
            <div class="question">23. You <span>______</span> not touch anything in the laboratory! <input name="q23"></div>
            <div class="question">24. All students <span>______</span> bring their books to school. <input name="q24"></div>
        </div>
        <h3>Part 2: Rewrite with Modal Verbs</h3>
        <div class="rewrite">
            <div class="rewrite-q">1. Some people just don’t know how to sing. (can’t) <input name="r1"></div>
            <div class="rewrite-q">2. There’s a chance that she’s at the airport. (could/might) <input name="r2"></div>
            <div class="rewrite-q">3. I have loved her for three years! (must) <input name="r3"></div>
            <div class="rewrite-q">4. I can’t run in the park: it’s rainy today. (can’t) <input name="r4"></div>
            <div class="rewrite-q">5. Sue lost track of this emergency exit. (mustn’t) <input name="r5"></div>
            <div class="rewrite-q">6. It’s dangerous to use mobile phones on the plane. (mustn’t) <input name="r6"></div>
            <div class="rewrite-q">7. It is impossible: my father never went to the foreign land! (can’t) <input name="r7"></div>
            <div class="rewrite-q">8. It’s possible that he’ll miss the train! (may) <input name="r8"></div>
            <div class="rewrite-q">9. This is a surprise. Can’t tell anybody about it. (shouldn’t) <input name="r9"></div>
        </div>
        <button type="button" class="check-grade" onclick="checkGrade()">Check Grade</button>
        <div class="export-box">
            <button type="button" onclick="window.print()">Print</button>
            <button type="button" onclick="copyPage()">Copy</button>
            <button type="button" id="pdfBtn">Export PDF</button>
            <button type="button" id="screenshotBtn">Screenshot</button>
            <button type="button" id="docxBtn">Export DOCX</button>
        </div>
    </form>
    <div class="answers" id="answersBox">
        <h4>Part 1 Answers</h4>
        1. Can<br>2. Can<br>3. Must<br>4. Will<br>5. Can<br>6. Could<br>7. Had to<br>8. Should<br>
        9. Can<br>10. Is<br>11. Must<br>12. Could<br>13. May<br>14. Might<br>15. Could<br>
        16. Must<br>17. Can / Can<br>18. Should<br>19. Can / Can<br>20. Must<br>21. Could<br>
        22. May<br>23. Must<br>24. Must
        <h4>Part 2 Answers</h4>
        1. Some people can’t sing.<br>
        2. She could/might be at the airport.<br>
        3. You must have loved her for three years.<br>
        4. I can’t run in the park today.<br>
        5. Sue mustn’t lose track of this emergency exit.<br>
        6. You mustn’t use mobile phones on the plane.<br>
        7. It can’t be true; my father never went to the foreign land.<br>
        8. He may miss the train.<br>
        9. This is a surprise. You shouldn’t tell anybody about it.
    </div>
</div>
<script>
let taps = 0, lastTap = 0;
document.getElementById("gradeBox").addEventListener("click", function() {
    let now = Date.now();
    if (now - lastTap < 1500) {
        taps++;
        if (taps >= 7) {
            document.getElementById('answersBox').style.display = 'block';
            taps = 0;
        }
    } else {
        taps = 1;
    }
    lastTap = now;
});
document.getElementById("pdfBtn").onclick = function() {
    const doc = new window.jspdf.jsPDF();
    doc.text(collectOutputText(), 10, 10);
    doc.save('modal-quiz.pdf');
};
document.getElementById("docxBtn").onclick = function() {
    let htmlContent = "<h2>Modal Verbs Worksheet</h2>";
    htmlContent += "<b>Name:</b> " + document.getElementById("studentName").value + "<br>";
    htmlContent += "<b>ID:</b> " + document.getElementById("studentID").value + "<br>";
    htmlContent += "<b>Grade:</b> " + document.getElementById("gradeSelect").value + "<br><br>";
    htmlContent += "<b>Part 1: Fill in the Blanks</b><br>";
    let form = document.getElementById('modalForm');
    let answers = [];
    for(let i=1; i<=24; i++) {
        let value = form['q'+i].value || "";
        htmlContent += i + ". ____ " + value + "<br>";
    }
    htmlContent += "<b>Part 2: Rewrite</b><br>";
    for(let i=1; i<=9; i++) {
        let value = form['r'+i].value || "";
        htmlContent += "R" + i + ". " + value + "<br>";
    }
    let blob = window.htmlDocx.asBlob('<html><body>' + htmlContent + '</body></html>');
    let link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'modal-quiz.docx';
    link.click();
};
function copyPage() {
    let temp = document.createElement("textarea");
    temp.value = collectOutputText();
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    document.body.removeChild(temp);
}
document.getElementById("screenshotBtn").onclick = function () {
    html2canvas(document.querySelector(".container")).then(canvas => {
        let a = document.createElement('a');
        a.href = canvas.toDataURL();
        a.download = 'modal-quiz.png';
        a.click();
    });
};

function collectOutputText(){
    let output = "Name: " + document.getElementById("studentName").value + "\n";
    output += "ID: " + document.getElementById("studentID").value + "\n";
    output += "Grade: " + document.getElementById("gradeSelect").value + "\n";
    output += "Part 1:\n";
    let form = document.getElementById('modalForm');
    for(let i=1; i<=24; i++) {
        let value = form['q'+i].value || "";
        output += i + ". ____ " + value + "\n";
    }
    output += "Part 2:\n";
    for(let i=1; i<=9; i++) {
        let value = form['r'+i].value || "";
        output += "R" + i + ". " + value + "\n";
    }
    return output;
}

function checkGrade() {
    // Correct answers arrays for part 1 and part 2 (main keywords, lowercase)
    let correct1 = [
        "can", "can", "must", "will", "can", "could", "had to", "should", "can", "is", "must", "could",
        "may", "might", "could", "must", ["can","can"], "should", ["can","can"], "must", "could", "may", "must", "must"
    ];
    let correct2 = [
        "can’t", "could", "must", "can’t", "mustn’t", "mustn’t", "can’t", "may", "shouldn’t"
    ];
    let form = document.getElementById('modalForm');
    let score = 0;
    // Part 1
    for(let i=1; i<=24; i++) {
        let ans = (form['q'+i].value||"").trim().toLowerCase();
        let corr = correct1[i-1];
        if(Array.isArray(corr)){
            let a = (form['q'+i+'a']?.value||"").trim().toLowerCase();
            let b = (form['q'+i+'b']?.value||"").trim().toLowerCase();
            score += (a==corr[0]?1:0)+(b==corr[1]?1:0);
        }else{
            if(ans==corr) score++;
        }
    }
    // Part 2 (accept 'could' or 'might' for r2)
    for(let i=1; i<=9; i++) {
        let ans = (form['r'+i].value||"").replace(/’/g,"'").trim().toLowerCase();
        if(i===2){
            if(ans.includes("could")||ans.includes("might")) score++;
        }else if(ans.includes(correct2[i-1])){
            score++;
        }
    }
    let maxScore = 24+2+9; // q17, q19 have 2 blanks each
    let percent = Math.round(100*score/maxScore);
    document.getElementById("scoreResult").innerText = "Score: " + score + " / " + maxScore + " (" + percent + "%)";
    document.getElementById("gradeValue").innerText = percent + "%";
}
</script>
</body>
</html>
